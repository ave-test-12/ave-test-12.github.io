import{R as t,v as a,r as o,fa as e,bR as n,bM as s,fb as u,a0 as i,fc as l,cv as r,fd as m,fe as c,ff as d,fg as f,fh as h,fi as p,fj as v,fk as _,fl as k}from"./CG6fUgW6.js";import{a as y,b}from"./DQCrn0z3.js";function w(){const w=t(),{t:T}=a(),g=o(!1);async function x(t,a){try{g.value=!0;await t.swapCallStatic();const o=t.swapInfo,e=(o.fromToken.isWrapper&&o.toToken.isETH||o.toToken.isWrapper&&o.fromToken.isETH,{from_address:o.fromToken.address,from_symbol:o.fromToken.symbol,from_amount:Number(v(o.fromTokenAmount||0,o.fromToken.decimals)),to_address:o.toToken.address,to_symbol:o.toToken.symbol,to_amount:Number(v(o.toTokenAmount||0,o.toToken.decimals)),chain:a,transaction:"",wallet_address:w.address});let s=null;t.swap().then((t=>(s=setTimeout((()=>{n({type:"success",message:T("transactionsSubmitted")})}),500),y({chain:a,destination:"wallet rpc",type:10,tx_hash:t.hash,status:1,wallet:w.address,out_token:e.to_address,out_amount:Number(v(o.toTokenAmount||0,o.toToken.decimals)),in_token:e.from_address,in_amount:Number(v(o.fromTokenAmount||0,o.fromToken.decimals))}),g.value=!1,t.wait()))).then((t=>{var o,e;return s&&(clearTimeout(s),s=null),n({type:"success",message:T("tradeSuccess")}),b({chain:a,tx_hash:t.hash,status:100,to:(null==(e=null==(o=null==t?void 0:t.to)?void 0:o.toLowerCase)?void 0:e.call(o))||""}),t})).catch((t=>{g.value=!1,c(t,"swap")}))}catch(o){g.value=!1,c(o,"swap")}}return{walletSwap:async function(t,a){var o,S,A;if(!(null==(S=null==(o=Object.keys(e))?void 0:o.includes)?void 0:S.call(o,a.chain))&&"solana"!==a.chain)return void n({title:"Error",type:"error",message:T("noSupportChain",{chain:s(a.chain).name})});if(a.chain!==w.chain)return void n({title:"Error",type:"error",message:T("chainNotSame1")});g.value=!0;let M=await function(t){return k({tokenAddress:"solana"===t?"So11111111111111111111111111111111111111112":r,chain:t})}(a.chain).catch((()=>({balance:"0"})));if((null==M?void 0:M.balance)<t||0===Number(null==M?void 0:M.balance))return n({title:"Error",type:"error",message:T("insufficientBalance")}),void(g.value=!1);const F=a.chain,N=a.token,E=a.amm,O=null==E?void 0:E.includes("fourmeme");if(Number(t)>0){const o=s(F).decimals;if("solana"===F)return void async function(t,a){var o;const e=t.chain;if("solana"===e){g.value=!0;const e=await h(t.token);let s=!1;const l=!1,r=9,m=null==e?void 0:e.token_decimals,d={inputMint:"So11111111111111111111111111111111111111112",inputDecimals:r,inputMintSymbol:"SOL",inputMintName:"SOL",inputAmount:a||0,outputMint:t.token,outputDecimals:m,outputMintSymbol:e.token_symbol,outputMintName:e.token_symbol,amount:u((null==(o=new i(a||0).toFixed().match(new RegExp(`[0-9]*(\\.[0-9]{0,${r}})?`)))?void 0:o[0])||0,r).toFixed(0),slippageBps:new i(30).times(100).toFixed(0),swapMode:"ExactIn",slippage:30,isPump:s,isMoonshot:l};g.value=!0;let f={};p(d).then((t=>{var a,o,e;let s="0";return t.routeInfo&&t.transaction?(f=t,s=(null==(e=null==(o=null==(a=t.routeInfo)?void 0:a.amountOut)?void 0:o.amount)?void 0:e.toFixed())||"0"):t.outAmount?(f=t,s=v(t.outAmount||"0",m)):c("can not get quote"),async function(t,a){try{g.value=!0;const o={from_address:a.inputMint,from_symbol:a.inputDecimals,from_amount:a.inputAmount,to_address:a.outputMint,to_symbol:a.outputDecimals,to_amount:a.toAmount,chain:"solana",transaction:"",wallet_address:w.address};let e=null;_(t).then((t=>(g.value=!1,e=setTimeout((()=>{n({type:"success",message:T("transactionsSubmitted")})}),500),y({chain:"solana",destination:"true"===localStorage.solanaProtection?"v1/blxrsol/sendSolTx":"/ave_nodes/rpc/solana/sendFastSwapTx",type:10,tx_hash:t.hash,status:1,wallet:w.address,out_token:o.to_address,out_amount:a.toAmount,in_token:o.from_address,in_amount:a.fromAmount}),t.wait()))).then((t=>{var a;return e&&(clearTimeout(e),e=null),n({type:"success",message:T("tradeSuccess")}),t&&b({chain:"solana",tx_hash:null==(a=null==t?void 0:t.transaction)?void 0:a.signatures[0],status:100}),t})).catch((t=>{"Timeout"===(t||(null==t?void 0:t.message))?n({type:"error",message:T("timeout_error")}):"Swap fail"===(t||(null==t?void 0:t.message))?n({type:"error",message:T("swapFail")}):c(t,"solana"),g.value=!1}))}catch(o){g.value=!1,c(o,"solana")}}(f,{...d,toAmount:s}),t})).catch((t=>(g.value=!1,c((null==t?void 0:t.error)||t),Promise.resolve(""))))}}(a,t);g.value=!0;const e={from_token:r,to_token:N,amountIn:u((null==(A=new i(t||0).toFixed().match(new RegExp(`[0-9]*(\\.[0-9]{0,${o}})?`)))?void 0:A[0])||0,o).toFixed(0),amountOut:"0"};if(O){try{const o=await l(e,F);m({fromAmount:u(t,18).toFixed(0),fromToken:{address:r,decimals:18,symbol:"BNB",amount:u(t,18).toFixed(0)},toToken:{address:a.token,decimals:18,symbol:"",amount:(null==o?void 0:o.amountOut)||"0"},isAmountOut:!1,quoteResult:{...o}},10).then((async t=>{x({...t,isFourMeme:!0},a.chain)})).catch((t=>{c(t)})),g.value=!1}catch(I){g.value=!1,c(I)}return}d(e,"",F).then((t=>{const a=t[0];f(a,30).then((async t=>{x(t,F)})).catch((t=>{c(t)}))})).catch((t=>{c(t)}))}},loadingWalletSwap:g}}export{w as u};
